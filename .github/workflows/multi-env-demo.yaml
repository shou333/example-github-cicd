name: Multi-line Environment Variable Issue Demo

on: workflow_dispatch

jobs:
  extract-content:
    runs-on: ubuntu-latest
    outputs:
      content: ${{ steps.extract.outputs.content }}
    steps:
      - name: Extract multi-line content
        id: extract
        run: |
          CONTENT="CREATE TABLE eportal_tool_deliver (
            eportal_tool_deliver BINARY(16) NOT NULL,
            eportal_tool_id INT NOT NULL,
            directory_id INT NOT NULL
          );
          CREATE TABLE offline_wb (
            offline_wb BINARY(16) NOT NULL,
            wb_content_id INT NOT NULL
          );"

          echo "content<<EOF" >> $GITHUB_OUTPUT
          echo "$CONTENT" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

  demonstrate-issue:
    needs: extract-content
    if: needs.extract-content.outputs.content != null
    runs-on: ubuntu-latest
    steps:
      - name: Problem Approach
        env:
          sql_content: ${{ needs.extract-content.outputs.content }}
        run: |
          echo "=== Problem: Using environment variable ==="
          echo ""
          echo "When you set multi-line content as env variable:"
          echo "  env:"
          echo "    sql: \${{ needs.extract-content.outputs.content }}"
          echo ""
          echo "And use it like this:"
          echo "  echo \"\${{ env.sql }}\" > query.sql"
          echo ""
          echo "The content might be mishandled in some scenarios."
          echo ""
          echo "File created:"
          echo "${{ env.sql_content }}" > /tmp/problem.sql
          wc -l /tmp/problem.sql
          echo ""

      - name: Solution Approach
        run: |
          echo ""
          echo "=== Solution: Using heredoc ==="
          echo ""
          echo "Use heredoc to pass content directly without env variable:"
          echo ""

          cat << 'EOF' > /tmp/solution.sql
          ${{ needs.extract-content.outputs.content }}
          EOF

          echo "File created:"
          wc -l /tmp/solution.sql
          echo ""
          echo "âœ“ Content passed safely without environment variable issues"
          echo ""
          echo "File content:"
          cat /tmp/solution.sql
